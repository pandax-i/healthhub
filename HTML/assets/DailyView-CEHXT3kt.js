import{r as i,j as O,o as G,w as P,c as a,a as s,b as u,t as c,d as H,e as _,v as D,k as J,F as v,f as j,l as Q,h as l,n as L,i as R,g as Y}from"./index-CMunT34Q.js";const W={class:"container mx-auto p-4 md:p-6 max-w-4xl"},X={class:"space-y-6"},Z={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},ee={class:"flex justify-between items-center"},te={key:0,class:"mt-4 border-t pt-4"},se={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},oe={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4"},ae={key:0},le={class:"space-y-2"},ne={class:"flex items-center gap-2"},re=["onClick"],ie=["onClick"],de=["onClick"],ue=["onClick"],ce={key:1,class:"mt-4"},me={class:"space-y-2"},pe={class:"flex items-center gap-2"},ye={key:0,class:"text-sm font-semibold text-green-600"},ge=["onClick"],be=["onClick"],xe={key:2,class:"text-center py-8 text-gray-500"},fe={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},ve={class:"flex gap-2"},he={key:0,class:"text-center py-4"},we={key:1,class:"mt-4 space-y-2"},_e={class:"font-semibold"},ke={key:0,class:"text-xs text-gray-500 mt-1 pl-2 border-l-2"},$e={key:2,class:"mt-4 text-center text-gray-500"},Ce="https://api.joru.email/api",Ie={__name:"DailyView",setup(Te){const k=i(!0),m=i(!1),d=i([]),g=i({}),y=i(new Date().toISOString().split("T")[0]),b=i(""),$=i("daily"),h=i(""),x=i([]),w=i(!1),E=i(!1),r=(o,e=!0)=>{const t=document.createElement("div");t.textContent=o,t.className=`fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl transition-all duration-300 z-50 ${e?"bg-green-500":"bg-red-500"}`,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>document.body.removeChild(t),300)},2e3)},p=async(o,e="GET",t=null)=>{const n={"Content-Type":"application/json"},M=localStorage.getItem("authToken");M&&(n.Authorization=`Bearer ${M}`);const N={method:e,headers:n};t&&(N.body=JSON.stringify(t));const f=await fetch(`${Ce}${o}`,N);if(!f.ok){const K=await f.json().catch(()=>({message:"请求失败"}));throw new Error(K.message||"服务器响应异常")}return f.status===204||f.headers.get("content-length")==="0"?null:f.json()},C=O(()=>(Array.isArray(d.value)?d.value:[]).filter(o=>o.item_type==="daily")),T=O(()=>(Array.isArray(d.value)?d.value:[]).filter(o=>o.item_type==="one-time")),V=async()=>{k.value=!0;try{await Promise.all([z(),A(y.value)])}catch{r("加载初始数据失败",!1)}finally{k.value=!1}},z=async()=>{try{const o=await p("/daily-logs/items");d.value=Array.isArray(o)?o:[]}catch(o){r(`获取清单项目失败: ${o.message}`,!1),d.value=[]}},A=async o=>{try{const e=await p(`/daily-logs/logs/${o}`);g.value=(Array.isArray(e)?e:[]).reduce((t,n)=>(t[n.item_name]=n,t),{})}catch(e){r(`获取当日记录失败: ${e.message}`,!1),g.value={}}},I=o=>g.value[o]?.status||"pending",S=async(o,e)=>{const t={log_date:y.value,item_name:o,status:e,notes:g.value[o]?.notes||""};try{await p("/daily-logs/logs","POST",t),await A(y.value)}catch(n){r(`更新状态失败: ${n.message}`,!1)}},F=async o=>{try{await p(`/daily-logs/items/${o.id}/complete`,"PUT"),r(`任务 "${o.item_name}" 已完成!`);const e=d.value.findIndex(t=>t.id===o.id);e!==-1&&(d.value[e].status="completed")}catch(e){r(`操作失败: ${e.message}`,!1)}},q=async()=>{if(!b.value.trim()){r("任务名称不能为空",!1);return}try{const o={item_name:b.value.trim(),item_type:$.value},e=await p("/daily-logs/items","POST",o);d.value.push(e),b.value="",r("新任务已添加")}catch(o){r(`添加失败: ${o.message}`,!1)}},U=async o=>{if(confirm(`确定要删除任务 "${o.item_name}" 吗？
这将同时删除所有相关的历史记录。`))try{await p(`/daily-logs/items/${o.id}`,"DELETE"),await V(),r("任务已删除")}catch(e){r(`删除失败: ${e.message}`,!1)}},B=async()=>{if(h.value.trim()){w.value=!0,E.value=!0;try{const o=await p(`/daily-logs/history/search?q=${encodeURIComponent(h.value.trim())}`);x.value=Array.isArray(o)?o:[]}catch(o){r(`搜索失败: ${o.message}`,!1),x.value=[]}finally{w.value=!1}}};return G(()=>{V()}),P(y,o=>{A(o)}),P([m,d,g],()=>{Y(()=>{typeof lucide<"u"&&lucide.createIcons()})},{deep:!0}),(o,e)=>(l(),a("div",W,[e[15]||(e[15]=s("header",{class:"mb-6"},[s("div",{class:"inline-block bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},[s("h1",{class:"text-2xl font-bold"},"每日清单"),s("p",{class:"text-gray-500 mt-1"},"追踪您的每日习惯与一次性任务")])],-1)),s("main",X,[s("div",Z,[s("div",ee,[e[5]||(e[5]=s("h2",{class:"text-xl font-semibold"},"任务管理",-1)),s("button",{onClick:e[0]||(e[0]=t=>m.value=!m.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all text-sm"},c(m.value?"完成":"添加 / 管理"),1)]),m.value?(l(),a("div",te,[s("form",{onSubmit:H(q,["prevent"]),class:"flex flex-col sm:flex-row gap-2 mb-4"},[_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),type:"text",placeholder:"输入新任务名称...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,b.value]]),_(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>$.value=t),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[...e[6]||(e[6]=[s("option",{value:"daily"},"每日任务",-1),s("option",{value:"one-time"},"一次性任务",-1)])],512),[[J,$.value]]),e[7]||(e[7]=s("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 添加 ",-1))],32)])):u("",!0)]),s("div",se,[s("div",oe,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold"},"今日任务",-1)),_(s("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,y.value]])]),C.value.length>0?(l(),a("div",ae,[e[9]||(e[9]=s("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"每日任务",-1)),s("ul",le,[(l(!0),a(v,null,j(C.value,t=>(l(),a("li",{key:t.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[s("span",null,c(t.item_name),1),s("div",ne,[I(t.item_name)==="pending"?(l(),a(v,{key:0},[s("button",{onClick:n=>S(t.item_name,"completed"),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,re),s("button",{onClick:n=>S(t.item_name,"skipped"),class:"text-xs bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 跳过 ",8,ie)],64)):(l(),a(v,{key:1},[s("span",{class:L([I(t.item_name)==="completed"?"text-green-600":"text-yellow-600","text-sm font-semibold"])},c(I(t.item_name)==="completed"?"今日已完成":"今日已跳过"),3),s("button",{onClick:n=>S(t.item_name,"pending"),class:"text-xs text-gray-500 hover:text-gray-700"}," 撤销 ",8,de)],64)),m.value?(l(),a("button",{key:2,onClick:n=>U(t),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,ue)):u("",!0)])]))),128))])])):u("",!0),T.value.length>0?(l(),a("div",ce,[e[10]||(e[10]=s("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"一次性任务",-1)),s("ul",me,[(l(!0),a(v,null,j(T.value,t=>(l(),a("li",{key:t.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[s("span",{class:L({"line-through text-gray-400":t.status==="completed"})},c(t.item_name),3),s("div",pe,[t.status==="completed"?(l(),a("span",ye,"已完成")):(l(),a("button",{key:1,onClick:n=>F(t),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,ge)),m.value?(l(),a("button",{key:2,onClick:n=>U(t),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,be)):u("",!0)])]))),128))])])):u("",!0),!k.value&&C.value.length===0&&T.value.length===0?(l(),a("div",xe,[...e[11]||(e[11]=[s("p",null,"暂无任务项目。",-1),s("p",null,'点击 "添加 / 管理" 来创建您的第一个任务吧！',-1)])])):u("",!0)]),s("div",fe,[e[14]||(e[14]=s("h2",{class:"text-xl font-semibold mb-4"},"历史记录查询",-1)),s("div",ve,[_(s("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t),onKeyup:Q(B,["enter"]),placeholder:"输入关键词搜索历史...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,544),[[D,h.value]]),s("button",{onClick:B,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 搜索 ")]),w.value?(l(),a("div",he,"正在搜索...")):u("",!0),x.value.length>0?(l(),a("ul",we,[(l(!0),a(v,null,j(x.value,t=>(l(),a("li",{key:t.id,class:"p-3 bg-gray-50 rounded-lg text-sm"},[s("span",_e,c(new Date(t.log_date).toLocaleDateString()),1),e[12]||(e[12]=R(" - ",-1)),s("span",null,c(t.item_name),1),e[13]||(e[13]=R(": ",-1)),s("span",{class:L(["font-medium",t.status==="completed"?"text-green-600":"text-yellow-600"])},c(t.status==="completed"?"已完成":"已跳过"),3),t.notes?(l(),a("p",ke,c(t.notes),1)):u("",!0)]))),128))])):u("",!0),!w.value&&x.value.length===0&&E.value?(l(),a("p",$e," 未找到相关记录。 ")):u("",!0)])])]))}};export{Ie as default};
