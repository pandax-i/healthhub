import{r as u,j as N,o as R,c as r,a as t,b as w,d as j,e as v,v as U,m as _,n as d,F as S,f as V,t as c,g as O,h as a}from"./index-CMunT34Q.js";const A={class:"container mx-auto p-4 md:p-6 max-w-3xl"},P={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},q={class:"flex items-center justify-between"},F={class:"flex items-center space-x-4"},G={class:"flex items-center"},H={class:"flex items-center"},J={class:"flex items-center"},Q={class:"mb-8"},K={class:"flex items-center justify-between bg-white/80 backdrop-blur-sm p-2 rounded-xl shadow-md mb-6 border border-white/20"},W={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},X={class:"space-y-3"},Y={class:"flex items-start"},Z=["checked","onChange"],ee={class:"flex items-center text-xs text-gray-500 mt-1"},te=["onClick"],se={class:"space-y-3"},le={key:0,class:"text-center py-8 bg-white/60 backdrop-blur-sm rounded-xl"},oe={key:1,class:"text-center py-8 bg-white/60 backdrop-blur-sm rounded-xl"},re={class:"font-semibold line-through text-gray-500"},ae={class:"text-sm text-gray-600"},ne="https://api.joru.email/api",ue={__name:"MemoView",setup(ie){const m=u({show:!1,message:"",isSuccess:!0}),p=u([]),o=u({task_name:"",priority:"medium"}),n=u("pending"),b=u(""),h=u([]),k=u(!1),x={high:{text:"高",color:"bg-red-500",border:"border-red-500"},medium:{text:"中",color:"bg-yellow-500",border:"border-yellow-500"},low:{text:"低",color:"bg-blue-500",border:"border-blue-500"}},$=N(()=>{let l=p.value;return n.value==="pending"&&(l=l.filter(e=>!e.is_completed)),n.value==="completed"&&(l=l.filter(e=>e.is_completed)),l}),i=(l,e=!0)=>{m.value={show:!0,message:l,isSuccess:e},setTimeout(()=>{m.value.show=!1},3e3)},y=async(l,e="GET",s=null)=>{const f={"Content-Type":"application/json"},C=localStorage.getItem("authToken");C&&(f.Authorization=`Bearer ${C}`);const T={method:e,headers:f};s&&(T.body=JSON.stringify(s));const g=await fetch(`${ne}${l}`,T);if(!g.ok){const L=await g.json().catch(()=>({message:"请求失败"}));throw new Error(L.message)}return g.status===204||g.headers.get("content-length")==="0"?null:g.json()},D=async()=>{try{p.value=await y("/memos"),O(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(l){i(`加载备忘录失败: ${l.message}`,!1)}},M=()=>{p.value.sort((l,e)=>{const s={high:1,medium:2,low:3};return l.is_completed!==e.is_completed?l.is_completed-e.is_completed:s[l.priority]-s[e.priority]})},E=async()=>{if(!o.value.task_name.trim()){i("任务内容不能为空",!1);return}try{const l=await y("/memos","POST",o.value);p.value.unshift(l),M(),o.value={task_name:"",priority:"medium"},i("任务已添加")}catch(l){i(`添加失败: ${l.message}`,!1)}},z=async l=>{try{const e=!l.is_completed;await y(`/memos/${l.id}/status`,"PUT",{is_completed:e}),l.is_completed=e,l.completed_at=e?new Date().toISOString():null,M()}catch(e){i(`更新状态失败: ${e.message}`,!1)}},B=async l=>{if(confirm(`确定要删除任务 "${l.task_name}" 吗？`))try{await y(`/memos/${l.id}`,"DELETE"),p.value=p.value.filter(e=>e.id!==l.id),i("任务已删除")}catch(e){i(`删除失败: ${e.message}`,!1)}},I=async()=>{if(!b.value.trim()){h.value=[];return}k.value=!0;try{const l=await y(`/memos/history/search?q=${encodeURIComponent(b.value)}`);h.value=l}catch(l){i("搜索失败: "+l.message,!1)}finally{k.value=!1}};return R(D),(l,e)=>(a(),r("div",A,[e[18]||(e[18]=t("header",{class:"mb-6"},[t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"备忘录"),t("p",{class:"text-gray-500 mt-1"},"记录和管理您的待办事项")])],-1)),t("div",P,[t("form",{onSubmit:j(E,["prevent"]),class:"space-y-4"},[v(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.task_name=s),placeholder:"需要做什么？",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[U,o.value.task_name]]),t("div",q,[t("div",F,[t("label",G,[v(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.priority=s),value:"high",class:"mr-1 text-red-500 focus:ring-red-500"},null,512),[[_,o.value.priority]]),e[8]||(e[8]=t("span",{class:"text-red-600 font-semibold"},"高",-1))]),t("label",H,[v(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.priority=s),value:"medium",class:"mr-1 text-yellow-500 focus:ring-yellow-500"},null,512),[[_,o.value.priority]]),e[9]||(e[9]=t("span",{class:"text-yellow-600 font-semibold"},"中",-1))]),t("label",J,[v(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.priority=s),value:"low",class:"mr-1 text-blue-500 focus:ring-blue-500"},null,512),[[_,o.value.priority]]),e[10]||(e[10]=t("span",{class:"text-blue-600 font-semibold"},"低",-1))])]),e[11]||(e[11]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md"}," 添加任务 ",-1))])],32)]),t("main",Q,[t("div",K,[t("button",{onClick:e[4]||(e[4]=s=>n.value="pending"),class:d([{"bg-blue-500 text-white":n.value==="pending"},"flex-1 py-2 px-4 rounded-lg"])}," 待办 ",2),t("button",{onClick:e[5]||(e[5]=s=>n.value="completed"),class:d([{"bg-blue-500 text-white":n.value==="completed"},"flex-1 py-2 px-4 rounded-lg"])}," 已完成 ",2),t("button",{onClick:e[6]||(e[6]=s=>n.value="all"),class:d([{"bg-blue-500 text-white":n.value==="all"},"flex-1 py-2 px-4 rounded-lg"])}," 全部 ",2)]),$.value.length===0?(a(),r("div",W,[...e[12]||(e[12]=[t("p",null,"太棒了！当前分类下没有任务。",-1)])])):w("",!0),t("div",X,[(a(!0),r(S,null,V($.value,s=>(a(),r("div",{key:s.id,class:d(["bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-sm flex items-start justify-between border-l-4",x[s.priority].border])},[t("div",Y,[t("input",{type:"checkbox",checked:s.is_completed,onChange:f=>z(s),class:"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-4 mt-1"},null,40,Z),t("div",null,[t("span",{class:d({"line-through text-gray-400":s.is_completed})},c(s.task_name),3),t("div",ee,[t("span",{class:d(["w-3 h-3 rounded-full mr-1",x[s.priority].color])},null,2),t("span",null,"优先级: "+c(x[s.priority].text),1),s.is_completed&&s.completed_at?(a(),r(S,{key:0},[e[13]||(e[13]=t("span",{class:"mx-2"},"|",-1)),t("span",null,"完成于: "+c(new Date(s.completed_at).toLocaleString("zh-CN")),1)],64)):w("",!0)])])]),t("button",{onClick:f=>B(s),class:"text-red-500 hover:text-red-700 p-1"},[...e[14]||(e[14]=[t("i",{"data-lucide":"trash-2",class:"w-5 h-5"},null,-1)])],8,te)],2))),128))])]),t("div",null,[e[17]||(e[17]=t("div",{class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md mb-4 border border-white/20"},[t("h2",{class:"text-xl font-semibold"},"查询已完成的任务")],-1)),t("form",{onSubmit:j(I,["prevent"]),class:"flex items-center space-x-2 mb-4"},[v(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>b.value=s),placeholder:"输入关键词搜索...",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[U,b.value]]),e[15]||(e[15]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md"}," 搜索 ",-1))],32),t("main",se,[k.value?(a(),r("div",le,[...e[16]||(e[16]=[t("p",null,"正在搜索...",-1)])])):h.value.length===0?(a(),r("div",oe,[t("p",null,c(b.value?"没有找到匹配的已完成记录":"输入关键词以查询历史"),1)])):w("",!0),(a(!0),r(S,null,V(h.value,s=>(a(),r("div",{key:s.id,class:d(["bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-sm border-l-4",x[s.priority].border])},[t("p",re,c(s.task_name),1),t("p",ae," 完成于: "+c(new Date(s.completed_at).toLocaleString("zh-CN")),1)],2))),128))])]),m.value.show?(a(),r("div",{key:0,class:d([m.value.isSuccess?"bg-green-500":"bg-red-500","fixed bottom-24 md:bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl z-50"])},c(m.value.message),3)):w("",!0)]))}};export{ue as default};
