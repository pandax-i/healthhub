import{r as l,o as h,c as r,a as s,b as d,t as u,d as k,e as b,v as g,n as P,h as n}from"./index-CMunT34Q.js";const _={class:"p-4 md:p-8"},S={class:"max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6"},j={key:0,class:"text-center"},B={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},T={class:"block sm:inline"},E={key:2,class:"space-y-4"},V={class:"mt-1 text-lg text-gray-900"},$={class:"mt-1 text-lg text-gray-900"},A={class:"mt-1 text-lg text-gray-900"},C={key:3},D={class:"space-y-4"},I={class:"mt-6"},M=["disabled"],U={key:4,class:"mt-6 p-4 bg-gray-100 rounded-lg"},f="https://api.joru.email/api",q={__name:"ProfileView",setup(z){const t=l(null),c=l(!0),p=l(""),a=l({oldPassword:"",newPassword:""}),v=l(!1),i=l(""),w=l(!1),x=async()=>{const m=localStorage.getItem("authToken");if(!m){p.value="您尚未登录。",c.value=!1;return}try{const e=await fetch(`${f}/me`,{headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}});if(!e.ok){const o=await e.json().catch(()=>({message:`服务器错误 (状态码: ${e.status})`}));throw new Error(o.message)}t.value=await e.json()}catch(e){p.value=e.message||"无法连接到服务器。"}finally{c.value=!1}},y=async()=>{v.value=!0,i.value="",w.value=!1;const m=localStorage.getItem("authToken");try{const e=await fetch(`${f}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify(a.value)}),o=await e.json();if(!e.ok)throw new Error(o.message||"操作失败。");i.value=o.message,a.value.oldPassword="",a.value.newPassword=""}catch(e){w.value=!0,i.value=e.message||"无法连接到服务器。"}finally{v.value=!1}};return h(x),(m,e)=>(n(),r("div",_,[s("div",S,[e[11]||(e[11]=s("h1",{class:"text-2xl font-bold text-gray-800 mb-6 border-b pb-4"},"我的账户",-1)),c.value?(n(),r("div",j,[...e[2]||(e[2]=[s("p",null,"正在加载用户信息...",-1)])])):d("",!0),p.value?(n(),r("div",B,[e[3]||(e[3]=s("strong",{class:"font-bold"},"加载失败：",-1)),s("span",T,u(p.value),1)])):d("",!0),t.value?(n(),r("div",E,[s("div",null,[e[4]||(e[4]=s("label",{class:"block text-sm font-medium text-gray-500"},"用户名",-1)),s("p",V,u(t.value.username||"未设置"),1)]),s("div",null,[e[5]||(e[5]=s("label",{class:"block text-sm font-medium text-gray-500"},"邮箱",-1)),s("p",$,u(t.value.email),1)]),s("div",null,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-gray-500"},"用户ID",-1)),s("p",A,u(t.value.id),1)])])):d("",!0),e[12]||(e[12]=s("hr",{class:"my-6"},null,-1)),t.value&&t.value.password_hash!==null?(n(),r("div",C,[e[9]||(e[9]=s("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"更改密码",-1)),s("form",{onSubmit:k(y,["prevent"])},[s("div",D,[s("div",null,[e[7]||(e[7]=s("label",{for:"oldPassword",class:"block text-sm font-medium text-gray-700"},"旧密码",-1)),b(s("input",{type:"password",id:"oldPassword","onUpdate:modelValue":e[0]||(e[0]=o=>a.value.oldPassword=o),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,a.value.oldPassword]])]),s("div",null,[e[8]||(e[8]=s("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"},"新密码 (至少6位)",-1)),b(s("input",{type:"password",id:"newPassword","onUpdate:modelValue":e[1]||(e[1]=o=>a.value.newPassword=o),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,a.value.newPassword]])])]),s("div",I,[s("button",{type:"submit",class:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all",disabled:v.value},u(v.value?"正在提交...":"确认更改"),9,M)])],32),i.value?(n(),r("p",{key:0,class:P(["mt-2 text-sm",w.value?"text-red-500":"text-green-600"])},u(i.value),3)):d("",!0)])):d("",!0),t.value&&t.value.password_hash===null?(n(),r("div",U,[...e[10]||(e[10]=[s("p",{class:"text-sm text-gray-700"},"您通过第三方服务 (linux.do) 登录，无需设置或更改密码。",-1)])])):d("",!0)])]))}};export{q as default};
