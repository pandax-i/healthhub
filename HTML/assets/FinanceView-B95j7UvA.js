import{r as x,j as C,o as J,c as n,a as e,b as p,n as g,t as o,F as T,f as V,d as $,e as i,v as b,k as A,g as Y,h as a}from"./index-CxoSaznF.js";const H={class:"container mx-auto p-4 md:p-6 max-w-4xl"},K={class:"flex items-center justify-between bg-white/80 backdrop-blur-sm p-2 rounded-xl shadow-md mb-6 border border-white/20"},Q={key:0},W={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},X={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},Z={class:"text-2xl font-bold"},tt={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},et={class:"text-2xl font-bold text-green-600"},st={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},lt={class:"text-2xl font-bold text-red-600"},nt={class:"md:col-span-3 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},ot={class:"text-3xl font-bold text-blue-600"},at={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},ut={class:"flex justify-between items-center mb-4"},dt={class:"space-y-2"},rt={class:"font-semibold"},it={key:1},pt={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},bt={class:"flex justify-between items-center mb-4"},mt={class:"space-y-3"},xt={class:"font-semibold"},vt={class:"text-xs text-gray-500"},ct={key:0,class:"text-xs text-gray-500 mt-1"},yt={key:2},ft={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},gt={class:"flex justify-between items-center mb-4"},wt={class:"space-y-3"},kt={class:"flex justify-between items-start"},_t={class:"font-semibold"},St={class:"text-xs text-gray-500"},Ct={key:0,class:"text-xs text-gray-500 mt-1"},Tt={class:"text-right"},Vt={key:0,class:"text-right mt-2"},$t=["onClick"],jt={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},Ut={class:"flex justify-end space-x-2"},Dt=["value"],At={class:"flex justify-end space-x-2"},Lt={class:"flex justify-end space-x-2"},qt="http://129.204.252.237:3000/api",Ot={__name:"FinanceView",setup(Ft){const w=x({show:!1,message:"",isSuccess:!0}),_=x([]),L=x([]),S=x([]),m=x("dashboard"),d=x(null),v=x({account_name:"",initial_balance:0}),u=x({account_id:null,transaction_type:"expense",amount:null,category:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}),r=x({loan_type:"lend",person_name:"",amount:null,notes:"",loan_date:new Date().toISOString().split("T")[0]}),q=C(()=>_.value.reduce((l,t)=>l+parseFloat(t.current_balance),0)),F=C(()=>S.value.filter(l=>l.loan_type==="lend"&&l.status==="unpaid").reduce((l,t)=>l+parseFloat(t.amount),0)),I=C(()=>S.value.filter(l=>l.loan_type==="borrow"&&l.status==="unpaid").reduce((l,t)=>l+parseFloat(t.amount),0)),N=C(()=>q.value+F.value-I.value),c=(l,t=!0)=>{w.value={show:!0,message:l,isSuccess:t},setTimeout(()=>{w.value.show=!1},3e3)},y=async(l,t="GET",s=null)=>{const D={"Content-Type":"application/json"},P=localStorage.getItem("authToken");P&&(D.Authorization=`Bearer ${P}`);const B={method:t,headers:D};s&&(B.body=JSON.stringify(s));const k=await fetch(`${qt}${l}`,B);if(!k.ok){const G=await k.json().catch(()=>({message:"请求失败"}));throw new Error(G.message)}return k.status===204||k.headers.get("content-length")==="0"?null:k.json()},z=async()=>{try{await Promise.all([j(),O(),U()])}finally{Y(()=>{typeof lucide<"u"&&lucide.createIcons()})}},j=async()=>{_.value=await y("/finance/accounts")},O=async()=>{L.value=await y("/finance/transactions")},U=async()=>{S.value=await y("/finance/loans")},E=async()=>{if(!v.value.account_name){c("账户名称不能为空",!1);return}await y("/finance/accounts","POST",v.value),c("账户已添加"),await j(),d.value=null,v.value={account_name:"",initial_balance:0}},M=async()=>{if(!u.value.account_id||!u.value.amount){c("账户和金额为必填项",!1);return}await y("/finance/transactions","POST",u.value),c("交易已记录"),await Promise.all([j(),O()]),d.value=null,u.value={account_id:null,transaction_type:"expense",amount:null,category:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}},h=async()=>{if(!r.value.person_name||!r.value.amount){c("对方姓名和金额为必填项",!1);return}await y("/finance/loans","POST",r.value),c("借贷已记录"),await U(),d.value=null,r.value={loan_type:"lend",person_name:"",amount:null,notes:"",loan_date:new Date().toISOString().split("T")[0]}},R=async l=>{l.status!=="paid"&&confirm(`确定要将这笔与 ${l.person_name} 的借贷标记为已还清吗？`)&&(await y(`/finance/loans/${l.id}/status`,"PUT",{status:"paid"}),c("状态已更新"),await U())},f=l=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(l);return J(z),(l,t)=>(a(),n("div",H,[t[52]||(t[52]=e("header",{class:"mb-6"},[e("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[e("h1",{class:"text-2xl font-bold"},"个人记账"),e("p",{class:"text-gray-500 mt-1"},"清晰掌握您的财务状况")])],-1)),e("div",K,[e("button",{onClick:t[0]||(t[0]=s=>m.value="dashboard"),class:g([{"bg-blue-500 text-white":m.value==="dashboard"},"flex-1 py-2 px-4 rounded-lg"])}," 总览 ",2),e("button",{onClick:t[1]||(t[1]=s=>m.value="transactions"),class:g([{"bg-blue-500 text-white":m.value==="transactions"},"flex-1 py-2 px-4 rounded-lg"])}," 交易明细 ",2),e("button",{onClick:t[2]||(t[2]=s=>m.value="loans"),class:g([{"bg-blue-500 text-white":m.value==="loans"},"flex-1 py-2 px-4 rounded-lg"])}," 借还款 ",2)]),m.value==="dashboard"?(a(),n("div",Q,[e("div",W,[e("div",X,[t[23]||(t[23]=e("p",{class:"text-sm text-gray-500"},"总资产",-1)),e("p",Z,o(f(q.value)),1)]),e("div",tt,[t[24]||(t[24]=e("p",{class:"text-sm text-gray-500"},"总借出",-1)),e("p",et,o(f(F.value)),1)]),e("div",st,[t[25]||(t[25]=e("p",{class:"text-sm text-gray-500"},"总借入",-1)),e("p",lt,o(f(I.value)),1)]),e("div",nt,[t[26]||(t[26]=e("p",{class:"text-sm text-gray-500"},"净资产 (总资产 + 总借出 - 总借入)",-1)),e("p",ot,o(f(N.value)),1)])]),e("div",at,[e("div",ut,[t[27]||(t[27]=e("h2",{class:"text-xl font-semibold"},"我的账户",-1)),e("button",{onClick:t[3]||(t[3]=s=>d.value="account"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 添加账户 ")]),e("ul",dt,[(a(!0),n(T,null,V(_.value,s=>(a(),n("li",{key:s.id,class:"flex justify-between items-center p-2 bg-gray-50 rounded-md"},[e("span",null,o(s.account_name),1),e("span",rt,o(f(s.current_balance)),1)]))),128))])])])):p("",!0),m.value==="transactions"?(a(),n("div",it,[e("div",pt,[e("div",bt,[t[28]||(t[28]=e("h2",{class:"text-xl font-semibold"},"交易明细",-1)),e("button",{onClick:t[4]||(t[4]=s=>d.value="transaction"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 记录一笔 ")]),e("ul",mt,[(a(!0),n(T,null,V(L.value,s=>(a(),n("li",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-md"},[e("div",null,[e("p",xt,o(s.category||(s.transaction_type==="income"?"收入":"支出")),1),e("p",vt,o(new Date(s.transaction_date).toLocaleDateString())+" · "+o(s.account_name),1),s.notes?(a(),n("p",ct,"备注: "+o(s.notes),1)):p("",!0)]),e("p",{class:g(["font-bold",s.transaction_type==="income"?"text-green-600":"text-red-600"])},o(s.transaction_type==="income"?"+":"-")+" "+o(f(s.amount)),3)]))),128))])])])):p("",!0),m.value==="loans"?(a(),n("div",yt,[e("div",ft,[e("div",gt,[t[29]||(t[29]=e("h2",{class:"text-xl font-semibold"},"借还款",-1)),e("button",{onClick:t[5]||(t[5]=s=>d.value="loan"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 添加记录 ")]),e("ul",wt,[(a(!0),n(T,null,V(S.value,s=>(a(),n("li",{key:s.id,class:"p-3 bg-gray-50 rounded-md"},[e("div",kt,[e("div",null,[e("p",_t,o(s.person_name),1),e("p",St,o(new Date(s.loan_date).toLocaleDateString()),1),s.notes?(a(),n("p",Ct,"备注: "+o(s.notes),1)):p("",!0)]),e("div",Tt,[e("p",{class:g(["font-bold",s.loan_type==="lend"?"text-green-600":"text-red-600"])},o(s.loan_type==="lend"?"借出":"借入")+" "+o(f(s.amount)),3),e("p",{class:g(["text-xs",s.status==="paid"?"text-gray-400":"text-orange-500"])},o(s.status==="paid"?`已于 ${new Date(s.repayment_date).toLocaleDateString()} 还清`:"未还清"),3)])]),s.status==="unpaid"?(a(),n("div",Vt,[e("button",{onClick:D=>R(s),class:"text-xs bg-green-100 text-green-700 hover:bg-green-200 py-1 px-3 rounded-md"}," 标记为已还清 ",8,$t)])):p("",!0)]))),128))])])])):p("",!0),d.value?(a(),n("div",{key:3,onClick:t[22]||(t[22]=$(s=>d.value=null,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[e("div",jt,[d.value==="account"?(a(),n("form",{key:0,onSubmit:$(E,["prevent"]),class:"space-y-4"},[t[33]||(t[33]=e("h2",{class:"text-xl font-bold"},"添加新账户",-1)),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm"},"账户名称",-1)),i(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>v.value.account_name=s),type:"text",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,v.value.account_name]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm"},"初始余额",-1)),i(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>v.value.initial_balance=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,v.value.initial_balance,void 0,{number:!0}]])]),e("div",Ut,[e("button",{type:"button",onClick:t[8]||(t[8]=s=>d.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),t[32]||(t[32]=e("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0),d.value==="transaction"?(a(),n("form",{key:1,onSubmit:$(M,["prevent"]),class:"space-y-4"},[t[43]||(t[43]=e("h2",{class:"text-xl font-bold"},"记录一笔交易",-1)),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm"},"类型",-1)),i(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>u.value.transaction_type=s),class:"w-full px-3 py-2 border rounded-md"},[...t[34]||(t[34]=[e("option",{value:"expense"},"支出",-1),e("option",{value:"income"},"收入",-1)])],512),[[A,u.value.transaction_type]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm"},"账户",-1)),i(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>u.value.account_id=s),required:"",class:"w-full px-3 py-2 border rounded-md"},[t[36]||(t[36]=e("option",{value:null,disabled:""},"选择一个账户",-1)),(a(!0),n(T,null,V(_.value,s=>(a(),n("option",{key:s.id,value:s.id},o(s.account_name),9,Dt))),128))],512),[[A,u.value.account_id,void 0,{number:!0}]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm"},"金额",-1)),i(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>u.value.amount=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,u.value.amount,void 0,{number:!0}]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm"},"分类 (可选)",-1)),i(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>u.value.category=s),type:"text",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,u.value.category]])]),e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm"},"日期",-1)),i(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>u.value.transaction_date=s),type:"date",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,u.value.transaction_date]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm"},"备注 (可选)",-1)),i(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=s=>u.value.notes=s),rows:"2",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,u.value.notes]])]),e("div",At,[e("button",{type:"button",onClick:t[15]||(t[15]=s=>d.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),t[42]||(t[42]=e("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0),d.value==="loan"?(a(),n("form",{key:2,onSubmit:$(h,["prevent"]),class:"space-y-4"},[t[51]||(t[51]=e("h2",{class:"text-xl font-bold"},"记录一笔借贷",-1)),e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm"},"类型",-1)),i(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>r.value.loan_type=s),class:"w-full px-3 py-2 border rounded-md"},[...t[44]||(t[44]=[e("option",{value:"lend"},"我借给别人",-1),e("option",{value:"borrow"},"别人借给我",-1)])],512),[[A,r.value.loan_type]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm"},"对方姓名",-1)),i(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>r.value.person_name=s),type:"text",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,r.value.person_name]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm"},"金额",-1)),i(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>r.value.amount=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,r.value.amount,void 0,{number:!0}]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"block text-sm"},"日期",-1)),i(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>r.value.loan_date=s),type:"date",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,r.value.loan_date]])]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm"},"备注 (可选)",-1)),i(e("textarea",{"onUpdate:modelValue":t[20]||(t[20]=s=>r.value.notes=s),rows:"2",class:"w-full px-3 py-2 border rounded-md"},null,512),[[b,r.value.notes]])]),e("div",Lt,[e("button",{type:"button",onClick:t[21]||(t[21]=s=>d.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),t[50]||(t[50]=e("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0)])])):p("",!0),w.value.show?(a(),n("div",{key:4,class:g([w.value.isSuccess?"bg-green-500":"bg-red-500","fixed bottom-24 md:bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl z-50"])},o(w.value.message),3)):p("",!0)]))}};export{Ot as default};
