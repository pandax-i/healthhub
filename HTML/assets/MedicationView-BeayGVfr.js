import{r as u,w as A,o as B,c as n,a as t,b as h,d as M,e as p,v as y,F as k,f as _,n as T,t as d,g as N,h as i,i as D}from"./index-CMunT34Q.js";const F={class:"container mx-auto p-4 md:p-6 max-w-3xl"},I={class:"flex justify-between items-center mb-6"},L={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},O={class:"md:col-span-2"},H={class:"md:col-span-2"},R={class:"md:col-span-2"},G={class:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-1"},J=["onUpdate:modelValue"],K={class:"mt-6 flex justify-end space-x-3"},Q={class:"space-y-4"},W={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},X={class:"flex flex-col md:flex-row justify-between items-start md:items-center"},Y={class:"flex-1 mb-4 md:mb-0"},Z={class:"text-lg font-bold"},ee={class:"text-sm"},te={key:0,class:"text-sm"},se={class:"text-sm"},oe={class:"font-semibold text-lg"},le={class:"flex flex-wrap gap-2 w-full md:w-auto"},ae=["onClick"],ne=["onClick"],ie=["onClick"],re=["onClick"],de={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},ue={class:"text-xl font-bold mb-4"},ce={key:0,class:"space-y-2 max-h-80 overflow-y-auto"},me={key:1,class:"text-gray-500 text-center py-4"},be={class:"mt-6 text-right"},ge="https://api.joru.email/api",ye={__name:"MedicationView",setup(fe){const c=u([]),b=u(!1),l=u({name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}),g=u({show:!1,message:"",isSuccess:!0}),v=u(!1),w=u([]),$=u("");A(()=>l.value.frequency,o=>{const e=Number(o)||1,s=l.value.times;if(e>s.length)for(let a=s.length;a<e;a++)s.push("12:00");else l.value.times=s.slice(0,e)});const r=(o,e=!0)=>{g.value={show:!0,message:o,isSuccess:e},setTimeout(()=>{g.value.show=!1},3e3)},m=async(o,e="GET",s=null)=>{const a={"Content-Type":"application/json"},x=localStorage.getItem("authToken");x&&(a.Authorization=`Bearer ${x}`);const C={method:e,headers:a};s&&(C.body=JSON.stringify(s));const f=await fetch(`${ge}${o}`,C);if(!f.ok){const z=await f.json().catch(()=>({message:"请求失败"}));throw new Error(z.message)}return f.status===204||f.headers.get("content-length")==="0"?null:f.json()},S=async()=>{try{c.value=await m("/medications"),N(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(o){r(`加载用药记录失败: ${o.message}`,!1)}},V=async()=>{try{const o={...l.value,medication_times:l.value.times.join(",")},e=await m("/medications","POST",o);c.value.unshift({...o,id:e.id}),r("添加成功！"),b.value=!1,l.value={name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}}catch(o){r(`添加失败: ${o.message}`,!1)}},j=async o=>{if(confirm(`确定要删除 "${o.name}" 吗?`))try{await m(`/medications/${o.id}`,"DELETE"),c.value=c.value.filter(e=>e.id!==o.id),r("删除成功")}catch(e){r(`删除失败: ${e.message}`,!1)}},q=async o=>{const e=prompt(`为 "${o.name}" 补充多少库存?`,"10");if(e&&!isNaN(e)){const s={...o,stock:(o.stock||0)+parseInt(e)};try{await m(`/medications/${o.id}`,"PUT",s),o.stock=s.stock,r("库存补充成功")}catch(a){r(`补充失败: ${a.message}`,!1)}}},U=async o=>{const e=parseFloat(o.dosage)||1;if(o.stock>=e)try{await m(`/medications/${o.id}/take`,"POST",{dosageAmount:e}),o.stock-=e,r(`已服用: ${o.name}`)}catch(s){r(`操作失败: ${s.message}`,!1)}else r("库存不足！",!1)},E=async o=>{try{$.value=o.name,w.value=await m(`/medications/${o.id}/logs`),v.value=!0,N(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(e){r(`加载历史失败: ${e.message}`,!1)}};return B(()=>{S()}),(o,e)=>(i(),n("div",F,[t("header",I,[e[9]||(e[9]=t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"用药记录"),t("p",{class:"text-gray-500 mt-1"},"管理您的用药计划")],-1)),t("button",{onClick:e[0]||(e[0]=s=>b.value=!b.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center space-x-2"},[...e[8]||(e[8]=[t("i",{"data-lucide":"plus-circle",class:"w-5 h-5"},null,-1),t("span",null,"添加药品",-1)])])]),t("div",{class:T(["form-container",{open:b.value}])},[t("div",L,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold mb-4"},"添加新的用药计划",-1)),t("form",{onSubmit:M(V,["prevent"])},[t("div",P,[t("div",O,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"药品名称",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.name=s),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.name]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"每次用量",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.dosage=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.dosage]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"每日次数",-1)),p(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.frequency=s),min:"1",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.frequency,void 0,{number:!0}]])]),t("div",H,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"当前库存",-1)),p(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.stock=s),min:"0",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.stock,void 0,{number:!0}]])]),t("div",R,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"服药时间",-1)),t("div",G,[(i(!0),n(k,null,_(l.value.times,(s,a)=>(i(),n("div",{key:a},[p(t("input",{type:"time","onUpdate:modelValue":x=>l.value.times[a]=x,required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,8,J),[[y,l.value.times[a]]])]))),128))])])]),t("div",K,[t("button",{type:"button",onClick:e[5]||(e[5]=s=>b.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 取消 "),e[15]||(e[15]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all"}," 确认添加 ",-1))])],32)])],2),t("main",Q,[c.value.length===0?(i(),n("div",W,[...e[17]||(e[17]=[t("i",{"data-lucide":"pilcrow",class:"mx-auto h-12 w-12 text-gray-400"},null,-1),t("h3",{class:"mt-2 text-sm font-medium"},"暂无药品记录",-1)])])):h("",!0),(i(!0),n(k,null,_(c.value,s=>(i(),n("div",{key:s.id,class:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-5 border-l-4 border-blue-500 border-white/20"},[t("div",X,[t("div",Y,[t("h3",Z,d(s.name),1),t("p",ee," 用法: "+d(s.dosage||"未设置")+" / 每次, "+d(s.frequency||"N/A")+"次 / 每日 ",1),s.medication_times?(i(),n("p",te,"时间: "+d(s.medication_times),1)):h("",!0),t("p",se,[e[18]||(e[18]=D(" 库存: ",-1)),t("span",oe,d(s.stock||0),1)])]),t("div",le,[t("button",{onClick:a=>U(s),class:"flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 服用 ",8,ae),t("button",{onClick:a=>E(s),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 记录 ",8,ne),t("button",{onClick:a=>q(s),class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 补充 ",8,ie),t("button",{onClick:a=>j(s),class:"flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 删除 ",8,re)])])]))),128))]),v.value?(i(),n("div",{key:0,onClick:e[7]||(e[7]=M(s=>v.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",de,[t("h2",ue,'"'+d($.value)+'" 的服药历史',1),w.value.length>0?(i(),n("ul",ce,[(i(!0),n(k,null,_(w.value,s=>(i(),n("li",{key:s.id,class:"p-2 bg-gray-100 rounded-md text-sm"},d(new Date(s.taken_at).toLocaleString("zh-CN")),1))),128))])):(i(),n("p",me,"暂无服药记录")),t("div",be,[t("button",{onClick:e[6]||(e[6]=s=>v.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 关闭 ")])])])):h("",!0),g.value.show?(i(),n("div",{key:1,class:T([g.value.isSuccess?"bg-green-500":"bg-red-500","fixed bottom-24 md:bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl z-50"])},d(g.value.message),3)):h("",!0)]))}};export{ye as default};
