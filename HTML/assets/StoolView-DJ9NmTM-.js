import{r as p,j as k,o as R,c as n,a as t,b as m,t as d,F as _,f as $,d as T,e as v,v as D,k as U,n as I,g as G,h as a}from"./index-DYv-fsP3.js";const J={class:"container mx-auto p-4 md:p-6 max-w-3xl"},Q={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md mb-6 border border-white/20"},H={class:"flex items-center justify-between mb-2"},K={class:"font-semibold text-lg"},W={class:"grid grid-cols-7 gap-1"},X={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},Z={class:"space-y-4"},ee=["value"],te={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},oe={class:"space-y-3"},le={class:"font-semibold"},se={class:"text-sm text-gray-700"},ne={key:0,class:"text-xs text-gray-500 mt-1 pl-1 border-l-2"},ae={class:"flex space-x-2"},re=["onClick"],de=["onClick"],ue={key:1,class:"text-center text-sm text-gray-500 mt-4"},ie={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},be={class:"space-y-4"},ce=["value"],ge={class:"mt-6 flex justify-end space-x-2"},pe="https://api.joru.email/api",fe={__name:"StoolView",setup(me){const x=p({show:!1,message:"",isSuccess:!0}),b=p(new Date),u=p([]),c=p(""),w=p(!1),r=p(null),i=p({log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""}),L={1:"颗粒状硬球",2:"香肠状，表面凹凸",3:"香肠状，表面有裂痕",4:"香肠或蛇状，光滑柔软",5:"断边光滑的柔软团块",6:"蓬松的糊状、烂便",7:"水样，无固体块"},C=k(()=>c.value?u.value.filter(l=>l.log_date.includes(c.value)||l.notes&&l.notes.includes(c.value)):u.value),j=k(()=>c.value?C.value:C.value.slice(0,3)),Y=k(()=>{const l=b.value.getFullYear(),e=b.value.getMonth(),o=new Date(l,e,1).getDay(),s=new Date(l,e+1,0).getDate(),f=Array.from({length:s},(y,M)=>M+1);return[...Array.from({length:o===0?6:o-1},()=>null),...f]}),F=k(()=>b.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})),A=k(()=>{const l=new Set;for(const e of u.value)e.log_date&&typeof e.log_date=="string"&&l.add(e.log_date.split("T")[0]);return l}),g=(l,e=!0)=>{x.value={show:!0,message:l,isSuccess:e},setTimeout(()=>{x.value.show=!1},3e3)},S=async(l,e="GET",o=null)=>{const s={"Content-Type":"application/json"},f=localStorage.getItem("authToken");f&&(s.Authorization=`Bearer ${f}`);const h={method:e,headers:s};o&&(h.body=JSON.stringify(o));const y=await fetch(`${pe}${l}`,h);if(!y.ok){const M=await y.json().catch(()=>({message:"请求失败"}));throw new Error(M.message)}return y.status===204||y.headers.get("content-length")==="0"?null:y.json()},z=async()=>{await V(),G(()=>{typeof lucide<"u"&&lucide.createIcons()})},V=async()=>{try{u.value=await S("/stool-logs")}catch(l){g(`加载记录失败: ${l.message}`,!1)}},B=async()=>{try{const l={...i.value,stool_type:i.value.stool_type?parseInt(i.value.stool_type):null},e=await S("/stool-logs","POST",l);u.value.unshift(e),g("记录已保存！"),i.value={log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""}}catch(l){g(`保存失败: ${l.message}`,!1)}},N=l=>{r.value={...l,stool_type:l.stool_type||null,log_date:l.log_date.split("T")[0]},w.value=!0},O=async()=>{if(r.value)try{const l=await S(`/stool-logs/${r.value.id}`,"PUT",r.value),e=u.value.findIndex(o=>o.id===l.id);e!==-1&&(u.value[e]=l),g("更新成功！"),w.value=!1,r.value=null,await V()}catch(l){g(`更新失败: ${l.message}`,!1)}},q=async l=>{if(confirm("确定要删除这条记录吗？"))try{await S(`/stool-logs/${l.id}`,"DELETE"),u.value=u.value.filter(e=>e.id!==l.id),g("删除成功")}catch(e){g(`删除失败: ${e.message}`,!1)}},E=l=>{const e=new Date(b.value);e.setMonth(e.getMonth()+l),b.value=e},P=l=>{const e={},o=new Date,s=o.getDate()===l&&o.getMonth()===b.value.getMonth()&&o.getFullYear()===b.value.getFullYear(),f=`${b.value.getFullYear()}-${String(b.value.getMonth()+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,h=A.value.has(f);return s&&(e["bg-blue-100"]=!0,e["text-blue-600"]=!0,e["font-bold"]=!0),h&&(e["bg-red-200"]=!0,e["text-red-700"]=!0,e["font-semibold"]=!0),e};return R(z),(l,e)=>(a(),n("div",J,[e[29]||(e[29]=t("header",{class:"mb-6"},[t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"排便记录"),t("p",{class:"text-gray-500 mt-1"},"记录您的每日健康状况")])],-1)),t("div",Q,[t("div",H,[t("button",{onClick:e[0]||(e[0]=o=>E(-1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[11]||(e[11]=[t("i",{"data-lucide":"chevron-left"},null,-1)])]),t("h3",K,d(F.value),1),t("button",{onClick:e[1]||(e[1]=o=>E(1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[12]||(e[12]=[t("i",{"data-lucide":"chevron-right"},null,-1)])])]),e[13]||(e[13]=t("div",{class:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2"},[t("span",null,"一"),t("span",null,"二"),t("span",null,"三"),t("span",null,"四"),t("span",null,"五"),t("span",null,"六"),t("span",null,"日")],-1)),t("div",W,[(a(!0),n(_,null,$(Y.value,(o,s)=>(a(),n("div",{key:s,class:"h-9 flex items-center justify-center"},[o?(a(),n("div",{key:0,class:I(["w-8 h-8 flex items-center justify-center rounded-full relative transition-colors",P(o)])},d(o),3)):m("",!0)]))),128))])]),t("div",X,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold mb-4"},"添加记录",-1)),t("form",{onSubmit:T(B,["prevent"])},[t("div",Z,[t("div",null,[e[14]||(e[14]=t("label",{for:"stool-date-add",class:"block text-sm font-medium text-gray-700"},"日期",-1)),v(t("input",{type:"date",id:"stool-date-add","onUpdate:modelValue":e[2]||(e[2]=o=>i.value.log_date=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,i.value.log_date]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"stool-type-add",class:"block text-sm font-medium text-gray-700"},"大便类型 (布里斯托分类法)",-1)),v(t("select",{id:"stool-type-add","onUpdate:modelValue":e[3]||(e[3]=o=>i.value.stool_type=o),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[e[15]||(e[15]=t("option",{value:null},"不记录类型",-1)),(a(),n(_,null,$(L,(o,s)=>t("option",{key:s,value:s}," 类型"+d(s)+": "+d(o),9,ee)),64))],512),[[U,i.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"stool-notes-add",class:"block text-sm font-medium text-gray-700"},"备注",-1)),v(t("textarea",{id:"stool-notes-add","onUpdate:modelValue":e[4]||(e[4]=o=>i.value.notes=o),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"例如：颜色、感觉等..."},null,512),[[D,i.value.notes]])])]),e[18]||(e[18]=t("div",{class:"mt-6 flex justify-end"},[t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center space-x-2"},[t("i",{"data-lucide":"save",class:"w-5 h-5"}),t("span",null,"保存记录")])],-1))],32)]),t("main",null,[e[22]||(e[22]=t("h2",{class:"text-xl font-semibold mb-4"},"历史记录",-1)),v(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>c.value=o),placeholder:"按日期(YYYY-MM-DD)或备注搜索...",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm mb-4"},null,512),[[D,c.value]]),j.value.length===0?(a(),n("div",te,[t("p",null,d(c.value?"没有找到匹配的记录":"最近没有记录"),1)])):m("",!0),t("div",oe,[(a(!0),n(_,null,$(j.value,o=>(a(),n("div",{key:o.id,class:"bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-sm flex justify-between items-start border border-white/20"},[t("div",null,[t("p",le,d(new Date(o.log_date).toLocaleDateString()),1),t("p",se,d(o.stool_type?`类型${o.stool_type}: ${L[o.stool_type]}`:"已记录"),1),o.notes?(a(),n("p",ne," 备注: "+d(o.notes),1)):m("",!0)]),t("div",ae,[t("button",{onClick:s=>N(o),class:"text-blue-500 hover:text-blue-700 p-1"},[...e[20]||(e[20]=[t("i",{"data-lucide":"edit-3",class:"w-4 h-4"},null,-1)])],8,re),t("button",{onClick:s=>q(o),class:"text-red-500 hover:text-red-700 p-1"},[...e[21]||(e[21]=[t("i",{"data-lucide":"trash-2",class:"w-4 h-4"},null,-1)])],8,de)])]))),128))]),!c.value&&u.value.length>3?(a(),n("p",ue," 仅显示最近3条记录，使用搜索框查看更多。 ")):m("",!0)]),w.value?(a(),n("div",{key:0,onClick:e[10]||(e[10]=T(o=>w.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",ie,[e[28]||(e[28]=t("h2",{class:"text-xl font-bold mb-4"},"编辑记录",-1)),r.value?(a(),n("form",{key:0,onSubmit:T(O,["prevent"])},[t("div",be,[t("div",null,[e[23]||(e[23]=t("label",{for:"stool-date-edit",class:"block text-sm font-medium text-gray-700"},"日期",-1)),v(t("input",{type:"date",id:"stool-date-edit","onUpdate:modelValue":e[6]||(e[6]=o=>r.value.log_date=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,r.value.log_date]])]),t("div",null,[e[25]||(e[25]=t("label",{for:"stool-type-edit",class:"block text-sm font-medium text-gray-700"},"大便类型",-1)),v(t("select",{id:"stool-type-edit","onUpdate:modelValue":e[7]||(e[7]=o=>r.value.stool_type=o),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[e[24]||(e[24]=t("option",{value:null},"不记录类型",-1)),(a(),n(_,null,$(L,(o,s)=>t("option",{key:s,value:s}," 类型"+d(s)+": "+d(o),9,ce)),64))],512),[[U,r.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{for:"stool-notes-edit",class:"block text-sm font-medium text-gray-700"},"备注",-1)),v(t("textarea",{id:"stool-notes-edit","onUpdate:modelValue":e[8]||(e[8]=o=>r.value.notes=o),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,r.value.notes]])])]),t("div",ge,[t("button",{type:"button",onClick:e[9]||(e[9]=o=>w.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg"}," 取消 "),e[27]||(e[27]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"}," 保存更改 ",-1))])],32)):m("",!0)])])):m("",!0),x.value.show?(a(),n("div",{key:1,class:I([x.value.isSuccess?"bg-green-500":"bg-red-500","fixed bottom-24 md:bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl z-50"])},d(x.value.message),3)):m("",!0)]))}};export{fe as default};
